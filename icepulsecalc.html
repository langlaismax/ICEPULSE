<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IcePulse — Split Time Calculator (Standalone)</title>
  <style>
    :root{ --bg:#fff; --text:#111; --muted:#666; --blue:#0a66ff; --card:#fafafa }
    html,body{height:100%;margin:0;padding:18px;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
    h1{margin:0 0 8px 0;font-size:20px}
    .card{border:1px solid #eee;border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.04);max-width:1100px;background:var(--card)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:12px}
    #display{font-size:48px;font-weight:800;margin-bottom:8px}
    button{cursor:pointer;border:0;padding:10px 14px;border-radius:8px}
    .primary{background:var(--blue);color:white}
    .alt{background:#fff;border:1px solid #ddd}
    input,select{padding:8px 10px;border-radius:8px;border:1px solid #ddd;font-size:16px}
    .small{font-size:13px;color:var(--muted)}
    #result{font-size:22px;margin-top:10px;font-weight:700}
    #log{max-height:240px;overflow:auto;margin-top:12px;border-top:1px dashed #eee;padding-top:8px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:6px 4px;text-align:left;border-bottom:1px solid #f4f4f4;font-size:13px}
    .grid {display:grid; grid-template-columns: 1fr 420px; gap:12px; align-items:start;}
    @media (max-width:980px){ .grid{ grid-template-columns: 1fr } }
    .chart-wrap{height:260px;padding:8px;border:1px solid #eee;border-radius:8px;background:white}
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <h1>IcePulse — Split Time Calculator (Standalone)</h1>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
      <div>
        <div id="display">0.00</div>
        <div class="small">Elapsed (seconds)</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button id="startStop" class="primary">Start</button>
        <button id="resetBtn" class="alt">Reset</button>
        <button id="grabBtn" class="alt">Use Display</button>
      </div>
    </div>

    <div class="row" style="margin-top:18px">
      <label for="entered" class="small">Entered split (s)</label>
      <input id="entered" type="number" step="0.01" placeholder="e.g. 13.25" />

      <label for="column" class="small">Column</label>
      <select id="column"></select>

      <button id="calcBtn" class="primary">Calculate real split</button>
      <button id="addLog" class="alt">Add to log</button>
      <button id="downloadCsv" class="alt">Download CSV</button>
    </div>

    <div id="result" aria-live="polite">Real split: —</div>

    <div class="grid" style="margin-top:12px">
      <div>
        <div id="log">
          <table id="logTable">
            <thead><tr><th>Timestamp</th><th>Column</th><th>Entered (s)</th><th>Real (s)</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div>
        <div class="small" style="margin-bottom:8px">Live view (last 10 splits)</div>
        <div class="chart-wrap">
          <canvas id="splitsChart" width="400" height="240" aria-label="Last ten splits chart" role="img"></canvas>
        </div>
      </div>
    </div>

    <div class="small" style="margin-top:10px">
      Behavior: stopping the stopwatch only copies the elapsed value into the Entered field. A log row is created <strong>only</strong> when you press <strong>Calculate real split</strong>. The Add-to-log button will require that a Calculate has been run first (prevents logging before calculation).
    </div>
  </div>

<script>
/* === conversion data (copied from your Python file) === */
const columns = [ "1","2","3","4","5","6","7","8","9","10","H" ];

const conversion_table = [
  [16.2,15.1,14.3,13.9,13.6,13.4,13.0,12.7,12.6,12.5,11.9],
  [16.3,15.2,14.4,14.0,13.7,13.5,13.1,12.8,12.7,12.6,11.9],
  [16.4,15.3,14.5,14.2,13.8,13.6,13.2,12.9,12.8,12.7,12.0],
  [16.5,15.4,14.6,14.3,14.0,13.7,13.3,13.0,12.9,12.8,12.1],
  [16.7,15.5,14.7,14.4,14.1,13.8,13.4,13.1,13.0,12.9,12.2],
  [16.8,15.6,14.8,14.5,14.2,13.9,13.5,13.2,13.1,12.9,12.3],
  [16.9,15.8,14.9,14.6,14.3,14.0,13.6,13.3,13.2,13.0,12.4],
  [17.0,15.9,15.0,14.7,14.4,14.1,13.7,13.4,13.2,13.1,12.5],
  [17.2,16.0,15.1,14.8,14.5,14.2,13.8,13.5,13.3,13.2,12.6],
  [17.3,16.1,15.3,14.9,14.6,14.3,13.9,13.5,13.4,13.3,12.7],
  [17.4,16.2,15.4,15.0,14.7,14.4,14.0,13.6,13.5,13.4,12.8],
  [17.5,16.3,15.5,15.1,14.8,14.5,14.1,13.7,13.6,13.5,12.9],
  [17.7,16.5,15.7,15.2,14.9,14.6,14.2,13.8,13.7,13.6,13.0],
  [17.8,16.6,15.8,15.4,15.0,14.7,14.3,13.9,13.8,13.7,13.1],
  [17.9,16.7,16.0,15.5,15.1,14.8,14.4,14.0,13.9,13.8,13.2],
  [18.1,16.9,16.1,15.6,15.2,14.9,14.5,14.1,14.0,13.9,13.2],
  [18.2,17.0,16.2,15.8,15.3,15.0,14.6,14.2,14.1,14.0,13.3],
  [18.3,17.1,16.4,15.9,15.5,15.1,14.7,14.3,14.2,14.1,13.4],
  [18.4,17.2,16.5,16.0,15.6,15.2,14.8,14.4,14.3,14.2,13.5],
  [18.5,17.3,16.6,16.1,15.7,15.3,14.9,14.5,14.4,14.3,13.5],
  [18.7,17.5,16.7,16.2,15.8,15.4,15.0,14.5,14.5,14.4,13.6],
  [18.8,17.6,16.8,16.4,15.9,15.6,15.1,14.7,14.6,14.5]()
